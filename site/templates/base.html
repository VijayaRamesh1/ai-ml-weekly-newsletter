<!doctype html>
<html lang="en" data-theme="light"><!-- default to clean light for execs -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>

  <style>
    /* =========================
       Executive Design Tokens
       ========================= */
    :root{
      /* Light (default) â€” boardroom calm */
      --bg: #fafbfc;
      --panel: #ffffff;
      --panel-2: #f4f7fb;
      --border: #e6ebf2;
      --text: #0b1426;
      --muted: #5b667a;
      --link: #0a5bd3;              /* Cobalt */
      --accent: #1140a6;            /* Deep cobalt */
      --accent-2: #d4a72c;          /* Executive gold */
      --ok: #147d64;                /* Teal */
      --warn: #b54708;              /* Amber-wood */
      --radius: 16px;
      --gap: 16px;
      --container: 980px;
      --measure: 68ch;
      --shadow: 0 1px 0 rgba(9,30,66,.05), 0 8px 28px rgba(9,30,66,.08);
      --shadow-strong: 0 10px 40px rgba(9,30,66,.12);
      --fs-0: 13px; --fs-1: 16px; --fs-2: 18px; --fs-3: 22px; --fs-4: 28px; --fs-5: 34px;
    }
    /* Dark â€” late-night review */
    [data-theme="dark"]{
      --bg: #0b0f17;
      --panel: #0f1522;
      --panel-2: #121a2a;
      --border: #1a2638;
      --text: #eaf1fa;
      --muted: #9fb0c8;
      --link: #9ac6ff;
      --accent: #5a8cff;
      --accent-2: #e0b95b;
      --ok: #63d4b8;
      --warn: #ffc173;
      --shadow: 0 10px 28px rgba(0,0,0,.45);
      --shadow-strong: 0 16px 44px rgba(0,0,0,.55);
    }

    /* Base */
    html,body{height:100%}
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font: var(--fs-1)/1.72 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Noto Sans", sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .container{max-width:var(--container); margin:0 auto; padding:32px 18px 80px}
    a{color:var(--link); text-decoration:none} a:hover{text-decoration:underline}
    .meta{color:var(--muted); font-size:var(--fs-0)}
    header{margin:0 0 12px}
    h1{
      margin:0 0 6px; font-weight:900; font-size:clamp(26px,3vw,34px); letter-spacing:.1px;
      background: linear-gradient(90deg, var(--accent), var(--text));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .strap{display:flex; align-items:center; gap:10px; color:var(--muted)}
    .strap .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:var(--panel-2); font-size:var(--fs-0)}

    /* Controls (sticky) */
    .controls{
      position:sticky; top:0; z-index:20;
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:10px 12px;
      box-shadow: var(--shadow);
      backdrop-filter: saturate(1.1) blur(6px);
    }
    .controls input[type="search"], .controls select{
      background:transparent; color:var(--text);
      border:1px solid var(--border); border-radius:10px; padding:9px 12px; min-width:200px; outline:none;
    }
    .btn{border:1px solid var(--border); background:var(--panel-2); color:var(--text); padding:9px 12px; border-radius:10px; cursor:pointer}
    .btn:hover{box-shadow: var(--shadow)}
    .spacer{flex:1 1 auto}

    /* Section index (Aâ€“G pills) */
    .section-index{display:flex; flex-wrap:wrap; gap:8px; margin:16px 0 8px}
    .pill{
      display:inline-flex; align-items:center; gap:10px; padding:8px 12px;
      border:1px solid var(--border); background:var(--panel); border-radius:999px; box-shadow: var(--shadow);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .pill:hover{ transform: translateY(-1px); box-shadow: var(--shadow-strong); }
    .badge{width:22px; height:22px; display:inline-grid; place-items:center; border-radius:999px; font-weight:700; font-size:12px;
      background: var(--panel-2); border:1px solid var(--border); color:var(--accent)}

    /* Cards */
    .list{display:flex; flex-direction:column; gap:16px; margin-top:8px}
    .cluster-title{
      margin:26px 0 6px; font-weight:800; letter-spacing:.06em; text-transform:uppercase; color:var(--muted);
      font-size:14px;
    }
    .card{
      position:relative; background:var(--panel); border:1px solid var(--border); border-radius:18px; padding:20px;
      box-shadow: var(--shadow); transition:transform .16s ease, box-shadow .16s ease, border-color .16s ease;
    }
    .card:hover{ transform: translateY(-2px); box-shadow: var(--shadow-strong); border-color: color-mix(in hsl, var(--border), var(--accent) 28%); }
    .topline{display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap}
    .rank{width:32px; height:32px; display:inline-grid; place-items:center; border-radius:999px; background:var(--panel-2); border:1px solid var(--border); font-weight:800; font-size:12px}
    .title{font-size: clamp(20px,2.4vw,26px); font-weight:800; line-height:1.25; max-width:var(--measure); margin:2px 0}
    .sub{color:var(--muted); font-size:13px; display:flex; flex-wrap:wrap; gap:8px; align-items:center}
    .chip{background:var(--panel-2); border:1px solid var(--border); border-radius:999px; padding:4px 9px}
    .kpis{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
    .kpis .chip{display:inline-flex; align-items:center; gap:6px}

    .sum{ margin-top:10px; max-width:var(--measure) }
    .eyebrow{display:block; color:var(--muted); font-size:12px; letter-spacing:.08em; text-transform:uppercase; margin:10px 0 2px}
    .sum p{ margin:10px 0 }
    body.skim .sum p{ display:-webkit-box; -webkit-line-clamp:4; -webkit-box-orient:vertical; overflow:hidden }

    /* Editor reason callout */
    .reason{ margin-top:8px; border-left:3px solid var(--accent-2); background:var(--panel-2); border:1px solid var(--border);
      padding:10px 12px; border-radius:10px; color:var(--text); }

    /* Score bars */
    .scores{margin-top:12px; display:grid; gap:8px}
    .bar{ display:grid; grid-template-columns:120px 1fr 44px; gap:10px; align-items:center; color:var(--muted); font-size:13px }
    .track{height:10px; border-radius:999px; background:var(--panel-2); border:1px solid var(--border); overflow:hidden}
    .fill{height:100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); }

    /* Floating Back-to-top */
    .to-top{
      position:fixed; right:18px; bottom:18px; z-index:25; opacity:0; pointer-events:none;
      transform: translateY(8px); transition: opacity .18s ease, transform .18s ease;
    }
    .to-top.show{ opacity:1; transform: translateY(0); pointer-events:auto; }
    .to-top .btn{border-radius:999px}

    @media (min-width: 1040px){ .container{padding:40px 24px 100px} .card{padding:24px} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>{{ header }}</h1>
      <div class="strap">
        <span class="meta">{{ subheader }}</span>
        <span class="pill" title="Generated datetime">ðŸ—“ {{ generated_at }}</span>
        <button id="theme" class="btn" type="button" aria-pressed="false" aria-label="Toggle theme">â˜¾/â˜€ï¸Ž</button>
      </div>
    </header>

    <!-- Controls -->
    <div class="controls" role="region" aria-label="Controls">
      <input id="q" type="search" placeholder="Search title & summaryâ€¦" aria-label="Search articles" />
      <select id="source" aria-label="Filter by source"><option value="">All sources</option></select>
      <select id="section" aria-label="Filter by section"><option value="">All sections</option></select>
      <select id="sort" aria-label="Sort">
        <option value="rank">Sort: Section rank</option>
        <option value="date">Sort: Date (newâ†’old)</option>
        <option value="score">Sort: Score</option>
      </select>
      <div class="spacer"></div>
      <button id="skim" class="btn" type="button" aria-pressed="false" title="Toggle skim mode">Skim</button>
    </div>

    {% block index %}{% endblock %}
    {% block content %}{% endblock %}

    <footer class="meta" style="margin-top:26px;">
      Â© {{ generated_at[:4] }} â€¢ Designed for executives â€¢ Section navigation at top â€¢ Use "Skim" for quick scan.
    </footer>
  </div>

  <!-- back to top -->
  <div class="to-top" id="toTop"><button class="btn" type="button" aria-label="Back to top">â†‘ Top</button></div>

  <script>
    // Theme toggle
    (function(){
      const root=document.documentElement,btn=document.getElementById('theme');
      const saved=localStorage.getItem('theme'); if(saved) root.setAttribute('data-theme',saved);
      btn.setAttribute('aria-pressed',(saved||'light')==='dark');
      btn.addEventListener('click',()=>{ const curr=root.getAttribute('data-theme')||'light';
        const next=(curr==='dark')?'light':'dark'; root.setAttribute('data-theme',next);
        btn.setAttribute('aria-pressed', next==='dark'); localStorage.setItem('theme',next); });
    })();

    // Skim mode
    (function(){
      const b=document.body,btn=document.getElementById('skim');
      const saved=localStorage.getItem('skim')==='1'; if(saved){ b.classList.add('skim'); btn.setAttribute('aria-pressed','true');}
      btn.addEventListener('click',()=>{ b.classList.toggle('skim');
        const on=b.classList.contains('skim'); btn.setAttribute('aria-pressed',on); localStorage.setItem('skim', on?'1':'0');});
    })();

    // Search / filter / sort
    (function(){
      const $q=document.getElementById('q'),
            $src=document.getElementById('source'),
            $sec=document.getElementById('section'),
            $sort=document.getElementById('sort');
      const list=document.querySelector('.list');
      const cards=[...document.querySelectorAll('.card')];
      // hydrate dropdowns
      const sources=[...new Set(cards.map(c=>c.dataset.source))].sort();
      sources.forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s;$src.appendChild(o);});
      const sections=[...new Set(cards.map(c=>c.dataset.section))].filter(Boolean);
      sections.forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s.replace(/^\w/, x=>x.toUpperCase());$sec.appendChild(o);});

      function apply(){
        const q=($q.value||'').toLowerCase().trim(),
              src=$src.value, sec=$sec.value, sort=$sort.value;
        cards.forEach(c=>{
          const hay=c.dataset.haystack;
          const okQ=!q||hay.includes(q);
          const okS=!src||c.dataset.source===src;
          const okC=!sec||c.dataset.section===sec;
          c.style.display=(okQ && okS && okC)?'':'none';
        });
        const vis=cards.filter(c=>c.style.display!=='none');
        vis.sort((a,b)=> sort==='score'
            ? (parseFloat(b.dataset.score)-parseFloat(a.dataset.score))
            : sort==='date'
              ? (b.dataset.date||'').localeCompare(a.dataset.date||'')
              : (a.dataset.section||'').localeCompare(b.dataset.section||'') || (parseInt(a.dataset.rank,10)-parseInt(b.dataset.rank,10)));
        vis.forEach(el=>list.appendChild(el));
      }
      [$q,$src,$sec,$sort].forEach(el=>el.addEventListener('input',apply)); apply();
    })();

    // Copy link (per-card) + Back to top reveal
    (function(){
      document.addEventListener('click',e=>{
        const btn=e.target.closest('[data-copy]'); if(!btn) return;
        navigator.clipboard.writeText(btn.dataset.copy).then(()=>{ btn.textContent='Link copied'; setTimeout(()=>btn.textContent='ðŸ”— Copy link',1200); });
      });
      const topBtn=document.getElementById('toTop');
      window.addEventListener('scroll',()=>{ const y=window.scrollY||document.documentElement.scrollTop; topBtn.classList.toggle('show', y>600); });
      topBtn.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
    })();
  </script>
</body>
</html>
