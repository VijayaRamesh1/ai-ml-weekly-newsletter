<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>

  <style>
    :root{
      /* Color tokens */
      --bg: #0b0d11; --panel:#0f1420; --border:#1b2231; --text:#e9eef6; --muted:#a7b1c3; --link:#8fd0ff;
      --badge:#1a2233; --accent:#52c3ff; --ok:#5fe1a1; --warn:#ffd166; --danger:#ff8aa0;
      /* Type & layout */
      --radius:16px; --gap:16px; --container:900px; --measure:70ch; --shadow:0 10px 30px rgba(0,0,0,.35);
      --fs-0:14px; --fs-1:16px; --fs-2:18px; --fs-3:22px; --fs-4:26px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f8fafc; --panel:#ffffff; --border:#e6eaf1; --text:#0f172a; --muted:#64748b; --link:#0a66c2; --badge:#eef2f6; }
    }
    [data-theme="light"]{ --bg:#f8fafc; --panel:#ffffff; --border:#e6eaf1; --text:#0f172a; --muted:#64748b; --link:#0a66c2; --badge:#eef2f6; }
    [data-theme="dark"] { --bg:#0b0d11; --panel:#0f1420; --border:#1b2231; --text:#e9eef6; --muted:#a7b1c3; --link:#8fd0ff; --badge:#1a2233; }

    /* Base */
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:var(--fs-1)/1.7 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",sans-serif}
    .container{max-width:var(--container);margin:0 auto;padding:26px 16px 56px}
    header{margin-bottom:14px}
    h1{margin:0 0 6px;font-weight:800;font-size:clamp(22px,2.5vw,28px);letter-spacing:.2px}
    .meta{color:var(--muted);font-size:var(--fs-0)}
    a{color:var(--link);text-decoration:none} a:hover{text-decoration:underline}

    /* Controls */
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;background:var(--panel);border:1px solid var(--border);padding:12px;border-radius:14px;box-shadow:var(--shadow);position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.1) blur(6px)}
    .controls input[type="search"], .controls select{background:transparent;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px;outline:none;min-width:180px}
    .spacer{flex:1 1 auto}
    .btn{border:1px solid var(--border);background:var(--badge);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer}

    /* Cards */
    .list{display:flex;flex-direction:column;gap:var(--gap);margin-top:18px}
    .card{position:relative;background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:20px;box-shadow:var(--shadow)}
    .card::before{content:"";position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:20px 0 0 20px;background:linear-gradient(180deg,var(--accent),transparent)}
    .topline{display:flex;align-items:flex-start;gap:10px;flex-wrap:wrap}
    .rank{display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:999px;background:var(--badge);font-weight:800;font-size:var(--fs-0)}
    .title{font-size:var(--fs-4);font-weight:800;margin:2px 0;line-height:1.25;max-width:var(--measure)}
    .sub{color:var(--muted);font-size:var(--fs-0);display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .chip{background:var(--badge);border:1px solid var(--border);padding:3px 8px;border-radius:999px}
    .sum{margin-top:10px;max-width:var(--measure);text-wrap:pretty;hyphens:auto}
    .sum p{margin:10px 0}
    .eyebrow{display:block;color:var(--muted);font-size:var(--fs-0);letter-spacing:.04em;text-transform:uppercase;margin-bottom:2px}
    .scores{margin-top:10px;display:grid;gap:8px}
    .bar{display:grid;grid-template-columns:76px 1fr 42px;gap:8px;align-items:center;font-size:var(--fs-0);color:var(--muted)}
    .track{height:10px;border-radius:999px;background:var(--badge);border:1px solid var(--border);overflow:hidden}
    .fill{height:100%;background:linear-gradient(90deg,var(--accent),#6be7cb)}
    .expand{margin-top:8px;font-size:var(--fs-0)}
    .expand button{background:transparent;border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:10px;cursor:pointer}

    /* Skim mode (clamps long paras) */
    body.skim .sum p{display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}
    @media (min-width: 920px){ .container{padding:34px 24px 74px} .card{padding:24px} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>{{ header }}</h1>
      <p class="meta">{{ subheader }}</p>
    </header>

    <div class="controls" role="region" aria-label="Controls">
      <input id="q" type="search" placeholder="Search title & summary…" aria-label="Search articles" />
      <select id="source" aria-label="Filter by source"><option value="">All sources</option></select>
      <select id="sort" aria-label="Sort">
        <option value="rank">Sort: Rank</option>
        <option value="score">Sort: Score</option>
        <option value="date">Sort: Date (new→old)</option>
      </select>
      <div class="spacer"></div>
      <button id="skim"  class="btn" type="button" aria-pressed="false" title="Toggle skim mode">Skim</button>
      <button id="theme" class="btn" type="button" aria-pressed="false" aria-label="Toggle theme">☾/☀︎</button>
    </div>

    {% block content %}{% endblock %}

    <footer class="meta" style="margin-top:24px;">
      Generated {{ generated_at }} • Ranked by Technical Innovation, Enterprise/Security Applicability, and Business Impact.
    </footer>
  </div>

  <script>
    // theme
    (function(){
      const root=document.documentElement,btn=document.getElementById('theme');
      const saved=localStorage.getItem('theme'); if(saved) root.setAttribute('data-theme',saved);
      btn.setAttribute('aria-pressed', (saved||'auto')==='dark');
      btn.addEventListener('click',()=>{ const curr=root.getAttribute('data-theme')||'auto';
        const next=(curr==='dark')?'light':'dark'; root.setAttribute('data-theme',next);
        btn.setAttribute('aria-pressed', next==='dark'); localStorage.setItem('theme',next);});
    })();
    // skim mode
    (function(){
      const b=document.body,btn=document.getElementById('skim');
      const saved=localStorage.getItem('skim')==='1'; if(saved) {b.classList.add('skim');btn.setAttribute('aria-pressed','true');}
      btn.addEventListener('click',()=>{ b.classList.toggle('skim');
        const on=b.classList.contains('skim'); btn.setAttribute('aria-pressed',on); localStorage.setItem('skim', on?'1':'0');});
    })();
    // search/filter/sort
    (function(){
      const $q=document.getElementById('q'),$src=document.getElementById('source'),$sort=document.getElementById('sort');
      const list=document.querySelector('.list'); const cards=Array.from(document.querySelectorAll('.card'));
      const sources=[...new Set(cards.map(c=>c.dataset.source))].sort();
      sources.forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s;$src.appendChild(o);});
      function apply(){
        const q=($q.value||'').toLowerCase().trim(),src=$src.value,sort=$sort.value;
        cards.forEach(c=>{const hay=c.dataset.haystack; const okQ=!q||hay.includes(q); const okS=!src||c.dataset.source===src; c.style.display=(okQ&&okS)?'':'';});
        const vis=cards.filter(c=>c.style.display!=='none');
        vis.sort((a,b)=> sort==='score'? (parseFloat(b.dataset.score)-parseFloat(a.dataset.score))
              : sort==='date'? (b.dataset.date||'').localeCompare(a.dataset.date||'')
              : (parseInt(a.dataset.rank,10)-parseInt(b.dataset.rank,10)));
        vis.forEach(el=>list.appendChild(el));
      }
      [$q,$src,$sort].forEach(el=>el.addEventListener('input',apply)); apply();
    })();
    // per-card expand
    (function(){
      document.addEventListener('click',e=>{
        const btn=e.target.closest('[data-expand]'); if(!btn) return;
        const card=btn.closest('.card'); card.classList.toggle('open');
        btn.textContent = card.classList.contains('open') ? 'Collapse' : 'Expand';
        if(document.body.classList.contains('skim') && card.classList.contains('open')){ /* temporarily un-skim this card */ }
      });
    })();
  </script>
</body>
</html>
